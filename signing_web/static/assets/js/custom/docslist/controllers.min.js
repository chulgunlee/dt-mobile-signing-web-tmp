function HeaderSvc(n){var r=defaults.docListHeader,t=0,i=0,u=[],f=function(t){r=t;n.$broadcast("HEADER_TEXT_UPDATED",r)},e=function(){return t>0?r:defaults.docListHeader};return{setHeaderText:f,getHeaderText:e,setDocumentsSelected:function(i){t=i;n.$broadcast("DOCUMENTS_COUNT_CHANGED",t)},getDocumentsSelected:function(){return t},setSelectedDocIndxs:function(t){u=t;n.$broadcast("SELECTED_DOC_INDXS_CHANGED",u)},getSelectedDocIndxs:function(){return u},addSignableDoc:function(){i++;n.$broadcast("SIGNABLE_DOCS_COUNT_CHANGED",i)},removeSignableDoc:function(){i--;n.$broadcast("SIGNABLE_DOCS_COUNT_CHANGED",i)}}}function HeaderCtrlr(n,t){n.headerText=t.getHeaderText();n.isAnyDocSelected=!1;n.isNoSignableDocsFound=!0;n.selectedDocIndxs=[];n.$on("HEADER_TEXT_UPDATED",function(){n.headerText=t.getHeaderText()});n.$on("DOCUMENTS_COUNT_CHANGED",function(){n.isAnyDocSelected=t.getDocumentsSelected()>0});n.$on("SELECTED_DOC_INDXS_CHANGED",function(){n.selectedDocIndxs=t.getSelectedDocIndxs()});n.$on("SIGNABLE_DOCS_COUNT_CHANGED",function(t,i){n.isNoSignableDocsFound=i<=0});n.onSelectSigners=function(){$("#signers-container").modal("show")};n.onPrintClicked=function(){var t=n.selectedDocIndxs.map(function(n){return n.DocIndexId}),i=defaults.apiUri+"printouts/"+t.join(";")+"?docMstrIndxId="+masterIndxId;WebViewBridge.call("print",{url:i})}}function DocsListCtrlr(n,t,i){var r=defaults.apiUri+"contractdetails/"+masterIndxId,u=function(n,t){$("#doc-preview-overlay .modal-body img").fadeOut(function(){$("#doc-preview-overlay .modal-header").fadeIn(function(){$("#doc-preview-overlay .modal-header h4").text(t);$("#doc-preview-overlay .modal-header h4").fadeIn()});$("#doc-preview-overlay .modal-body h3").fadeOut(function(){$("#doc-preview-overlay").addClass("preview-loaded");$("#doc-preview-overlay button.close").show();var t="";for(var i in n)t+='<img src="'+n[i]+'" />';$("#doc-preview-overlay .modal-body h3").html(t);$("#doc-preview-overlay .modal-body h3").fadeIn()})})},f=function(n){$("#doc-preview-overlay").removeClass("preview-loaded");$("#doc-preview-overlay button.close").hide();$("#doc-preview-overlay .modal-header h4").text("");$("#doc-preview-overlay .modal-header").hide();$("#doc-preview-overlay .modal-body").html('<img src="assets/images/loading-tr.gif" /><h3>Downloading <strong>'+n+"<\/strong> preview...<\/h3>")};t.get(r,{timeout:defaults.ajaxTimeout}).success(function(t,r){var u,f;if(r==302){WebViewBridge.call("exitSigningRoom",{status:"SessionTimeout"});return}for(n.documents=t.Documents,n.customers=t.Customers.join(" & "),n.signers=t.Signers,n.getSelectedDocsCount=function(){return n.documents.filter(function(n){return n.IsSelected}).length},n.isAnyDocSelected=function(){return n.getSelectedDocsCount()>0},n.updateHeader=function(){var t=n.getSelectedDocsCount();i.setDocumentsSelected(t);i.setHeaderText($().pluralize(t+" Document")+" Selected")},u=0;u<n.documents.length;u++)if(f=n.documents[u],f.IsSignable&&f.SigningStatus!=="Signed")n.onDocSelected(u);n.dataLoaded=!0}).error(function(){n.apiCallFailed=!0});n.initSelectedSigners=function(){var t,i,r,u;n.selectedSigners=[];for(t in n.selectedDocs)if(n.selectedDocs[t].SigningStatus!="Signed")for(i in n.selectedDocs[t].Signers)if(n.selectedDocs[t].Signers[i].SignStatus!="Signed"&&(r=!1,$.each(n.selectedSigners,function(u,f){f.Type==n.selectedDocs[t].Signers[i].Type&&(r=!0)}),!r))for(u in n.signers)n.signers[u].Type==n.selectedDocs[t].Signers[i].Type&&n.selectedSigners.push(n.signers[u])};n.onSignerSelected=function(t,i){if(!$(i.currentTarget).hasClass("signers-list-item-disabled")){n.signers[t].IsSelected=!n.signers[t].IsSelected;var r=n.selectedSigners.indexOf(n.signers[t]);n.signers[t].IsSelected?n.selectedSigners.push(n.signers[t]):n.selectedSigners.splice(r,1);n.updateSelectedDocs()}};n.updateSelectedDocs=function(){$.each(n.selectedDocs,function(t,i){i.anyReqdSignerSelected=!1;$.each(i.Signers,function(t,r){r.IsSelected=!1;$.each(n.selectedSigners,function(n,t){r.Type===t.Type&&(r.IsSelected=!0)});i.anyReqdSignerSelected=r.IsSelected||i.anyReqdSignerSelected})})};$("#signers-container").on("show.bs.modal",function(){n.SelectSigners()});$("#signers-container").on("shown.bs.modal",function(){n.isSignedDocFoundInSelection()&&$("#doc-mix-warning").modal("show")});$(".child-modal").on("show.bs.modal",function(){$(this).css("z-index",9999)});n.onContinueClick=function(){try{if(n.isDocRemovalReqd()){$("#doc-removal-notice").modal("show");return}var t=n.selectedDocs.map(function(n){return n.DocIndexId}),i=n.selectedSigners.map(function(n){return{FullName:n.FullName,Type:n.Type}});n.onFormSubmit(t,i)}catch(r){$("#remote-call-failed-msg-box .modal-body").html("Unable to send data to Signing Room.");$("#remote-call-failed-msg-box").modal("show");WebViewBridge.call("exitSigningRoom",{status:"RedirectError"})}};n.isDocRemovalReqd=function(){var t=!1;return $.each(n.selectedDocs,function(n,i){i.IsSignable&&!i.anyReqdSignerSelected&&(t=!0)}),t};n.onOkToRemoveDocsWOSingers=function(){var t=[],i;for($.each(n.selectedDocs,function(n,i){i.anyReqdSignerSelected||t.push(n)});t.length;)i=t.pop(),n.selectedDocs.splice(i,1);$("#doc-removal-notice").modal("hide");n.onContinueClick()};n.onFormSubmit=function(n,i){var r={documents:n,signers:i};t.post(defaults.apiUri+"doclist/session",r,{timeout:defaults.ajaxTimeout}).success(function(n,t){if(t==302){$("#remote-call-failed-msg-box .modal-body").html("Your session has expired. Please login again to continue signing.");$("#remote-call-failed-msg-box").modal("show");WebViewBridge.call("exitSigningRoom",{status:"SessionTimeout"});return}if(n){if(lockBypassEnabled){location.href="SigningRoom.aspx?docmasterindexid="+masterIndxId;return}WebViewBridge.call("lock",{"":""},function(){location.href="SigningRoom.aspx?docmasterindexid="+masterIndxId})}else $("#remote-call-failed-msg-box .modal-body").html("Unable to send data to Signing Room."),$("#remote-call-failed-msg-box").modal("show"),WebViewBridge.call("exitSigningRoom",{status:"RedirectError"})}).error(function(){$("#remote-call-failed-msg-box .modal-body").html("Unable to send data to Signing Room.");$("#remote-call-failed-msg-box").modal("show");WebViewBridge.call("exitSigningRoom",{status:"RedirectError"})})};n.SelectSigners=function(){var t,i;n.initSelectedSigners();n.disableUnneededSigners();n.updateSelectedDocs();for(t in n.signers){n.signers[t].IsSelected=!1;for(i in n.selectedSigners)if(n.signers[t].Type==n.selectedSigners[i].Type){n.signers[t].IsSelected=!0;break}}};n.disableUnneededSigners=function(){$(".signers-list-item").each(function(){$(this).hasClass("signers-list-item-disabled")&&$(this).removeClass("signers-list-item-disabled");for(var t in n.selectedSigners)if($(this).hasClass("signer-"+n.selectedSigners[t].Type.toLowerCase()))return;$(this).addClass("signers-list-item-disabled")})};n.onDocSelected=function(t){if(n.documents[t].IsSelected=!n.documents[t].IsSelected,n.documents[t].IsSelected)n.documents[t].SigningStatus==="Signed"?n.$broadcast("SIGNED_DOC_ADDED_TO_SELECTION"):(n.selectedDocs.push(n.documents[t]),n.documents[t].IsSignable&&i.addSignableDoc());else if(n.documents[t].SigningStatus==="Signed")n.$broadcast("SIGNED_DOC_REMOVED_FROM_SELECTION");else{var r=n.selectedDocs.indexOf(n.documents[t]);n.selectedDocs.splice(r,1);n.documents[t].IsSignable&&i.removeSignableDoc()}i.setSelectedDocIndxs(n.selectedDocs);n.updateHeader()};n.$on("SIGNED_DOC_ADDED_TO_SELECTION",function(){n.signedDocsInSelectionCount++});n.$on("SIGNED_DOC_REMOVED_FROM_SELECTION",function(){n.signedDocsInSelectionCount--});n.isSignedDocFoundInSelection=function(){return n.signedDocsInSelectionCount>0};n.onRibbonClicked=function(n){DismissPopoverByIx(n)};n.onDocBodyClicked=function(i,e){f(e);r=defaults.apiUri+"docpreviews/"+i+"?docMstrIndxId="+masterIndxId;$("#doc-preview-overlay").addClass("doc-preview-modal-"+i);$("#doc-preview-overlay").modal("show");n.docsPreview[i]==null?t.get(r,{timeout:defaults.ajaxTimeout}).success(function(t,i){if(i==302){WebViewBridge.call("exitSigningRoom",{status:"SessionTimeout"});return}var r=Object.keys(t)[0];n.docsPreview[r]=t[r];u(n.docsPreview[r],e)}).error(function(){$("#remote-call-failed-msg-box .modal-body").html("The document preview you requested is not available at this time. Please, try again later.");$("#remote-call-failed-msg-box").modal("show");$("#doc-preview-overlay").modal("hide")}):u(n.docsPreview[i],e)};n.dataLoaded=!1;n.apiCallFailed=!1;n.docsPreview={};n.selectedDocs=[];n.selectedSigners=[];n.signedDocsInSelectionCount=0}function onDocsRepeatCompleted(){return function(n){n.$last&&$("[id*=signing-status-for]").each(function(){$(this).hasClass("none")||$(this).popover({html:!0,container:"#docs-list-container",content:function(){return $(this).parents(".document").children("[id*=signeesFor]").html()},placement:"top",trigger:"click"})})}}function DismissPopoverByIx(n){$("[id*=signing-status-for]").each(function(t){n!=t&&$(this).popover("hide")})}var defaults={docListHeader:"Contract Documents",apiUri:apiUri,ajaxTimeout:ajaxTimeout,http_config:{headers:{Authorization:"Basic Y2FkbmFsbDpkdGRldnVzcjg4",Cookie:"SMCHALLENGE=YES"}}},myApp=angular.module("docsListApp",[]).directive("docsRepeatCompleted",onDocsRepeatCompleted).service("headerService",["$rootScope",HeaderSvc]).controller("HeaderCtrlr",["$scope","headerService",HeaderCtrlr]).controller("DocsListCtrlr",["$scope","$http","headerService",DocsListCtrlr]);
/*
//# sourceMappingURL=controllers.min.js.map
*/