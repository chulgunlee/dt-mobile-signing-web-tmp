(function(n){function t(t,i){function rt(){clearTimeout(a);a=!1;v=!1}function y(t,i){var o,e,u;if(t.preventDefault(),o=n(t.target).offset(),clearTimeout(a),a=!1,typeof t.targetTouches!="undefined"?(e=Math.floor(t.targetTouches[0].pageX-o.left),u=Math.floor(t.targetTouches[0].pageY-o.top)):(e=Math.floor(t.pageX-o.left),u=Math.floor(t.pageY-o.top)),s.x===e&&s.y===u)return!0;s.x===null&&(s.x=e);s.y===null&&(s.y=u);i&&(u+=i);f.beginPath();f.moveTo(s.x,s.y);f.lineTo(e,u);f.lineCap=r.penCap;f.stroke();f.closePath();h.push({lx:e,ly:u,mx:s.x,my:s.y});s.x=e;s.y=u;r.onDraw&&typeof r.onDraw=="function"&&r.onDraw.apply(c)}function d(){w()}function w(t){t?y(t,1):(b?o.each(function(){this.removeEventListener("touchmove",y)}):o.unbind("mousemove.signaturepad"),h.length>0&&r.onDrawEnd&&typeof r.onDrawEnd=="function"&&r.onDrawEnd.apply(c));s.x=null;s.y=null;r.output&&h.length>0&&n(r.output,u).val(JSON.stringify(h))}function ct(){if(!r.lineWidth)return!1;f.beginPath();f.lineWidth=r.lineWidth;f.strokeStyle=r.lineColour;f.moveTo(r.lineMargin,r.lineTop);f.lineTo(e.width-r.lineMargin,r.lineTop);f.stroke();f.closePath()}function g(){f.clearRect(0,0,e.width,e.height);f.fillStyle=r.bgColour;f.fillRect(0,0,e.width,e.height);r.displayOnly||ct();f.lineWidth=r.penWidth;f.strokeStyle=r.penColour;n(r.output,u).val("");h=[];w()}function ut(n,t){s.x==null?y(n,1):y(n,t)}function ft(n,t){b?t.addEventListener("touchmove",ut,!1):o.bind("mousemove.signaturepad",ut);y(n,1)}function lt(){nt=!1;o.each(function(){this.removeEventListener&&(this.removeEventListener("touchend",d),this.removeEventListener("touchcancel",d),this.removeEventListener("touchmove",y));this.ontouchstart&&(this.ontouchstart=null)});n(document).unbind("mouseup.signaturepad");o.unbind("mousedown.signaturepad");o.unbind("mousemove.signaturepad");o.unbind("mouseleave.signaturepad");n(r.clear,u).unbind("click.signaturepad")}function et(t){if(nt)return!1;nt=!0;n("input").blur();typeof t.targetTouches!="undefined"&&(b=!0);b?(o.each(function(){this.addEventListener("touchend",d,!1);this.addEventListener("touchcancel",d,!1)}),o.unbind("mousedown.signaturepad")):(n(document).bind("mouseup.signaturepad",function(){v&&(w(),rt())}),o.bind("mouseleave.signaturepad",function(n){v&&w(n);v&&!a&&(a=setTimeout(function(){w();rt()},500))}),o.each(function(){this.ontouchstart=null}))}function tt(){n(r.typed,u).hide();g();o.each(function(){this.ontouchstart=function(n){n.preventDefault();v=!0;et(n);ft(n,this)}});o.bind("mousedown.signaturepad",function(n){if(n.preventDefault(),n.which>1)return!1;v=!0;et(n);ft(n)});n(r.clear,u).bind("click.signaturepad",function(n){n.preventDefault();g()});n(r.typeIt,u).bind("click.signaturepad",function(n){n.preventDefault();ot()});n(r.drawIt,u).unbind("click.signaturepad");n(r.drawIt,u).bind("click.signaturepad",function(n){n.preventDefault()});n(r.typeIt,u).removeClass(r.currentClass);n(r.drawIt,u).addClass(r.currentClass);n(r.sig,u).addClass(r.currentClass);n(r.typeItDesc,u).hide();n(r.drawItDesc,u).show();n(r.clear,u).show()}function ot(){g();lt();n(r.typed,u).show();n(r.drawIt,u).bind("click.signaturepad",function(n){n.preventDefault();tt()});n(r.typeIt,u).unbind("click.signaturepad");n(r.typeIt,u).bind("click.signaturepad",function(n){n.preventDefault()});n(r.output,u).val("");n(r.drawIt,u).removeClass(r.currentClass);n(r.typeIt,u).addClass(r.currentClass);n(r.sig,u).removeClass(r.currentClass);n(r.drawItDesc,u).hide();n(r.clear,u).hide();n(r.typeItDesc,u).show();l=p=n(r.typed,u).css("font-size").replace(/px/,"")}function st(t){var i=n(r.typed,u),f=n.trim(t.replace(/>/g,"&gt;").replace(/</g,"&lt;")),o=k,s=l*.5;if(k=f.length,i.html(f),!f){i.css("font-size",p+"px");return}if(k>o&&i.outerWidth()>e.width)while(i.outerWidth()>e.width)l--,i.css("font-size",l+"px");if(k<o&&i.outerWidth()+s<e.width&&l<p)while(i.outerWidth()+s<e.width&&l<p)l++,i.css("font-size",l+"px")}function at(t,i){n("p."+i.errorClass,t).remove();t.removeClass(i.errorClass);n("input, label",t).removeClass(i.errorClass)}function vt(t,i,r){t.nameInvalid&&(i.prepend(['<p class="',r.errorClass,'">',r.errorMessage,"<\/p>"].join("")),n(r.name,i).focus(),n(r.name,i).addClass(r.errorClass),n("label[for="+n(r.name).attr("id")+"]",i).addClass(r.errorClass));t.drawInvalid&&i.prepend(['<p class="',r.errorClass,'">',r.errorMessageDraw,"<\/p>"].join(""))}function it(){var t=!0,i={drawInvalid:!1,nameInvalid:!1},f=[u,r],e=[i,u,r];return r.onBeforeValidate&&typeof r.onBeforeValidate=="function"?r.onBeforeValidate.apply(c,f):at.apply(c,f),r.drawOnly&&h.length<1&&(i.drawInvalid=!0,t=!1),n(r.name,u).val()===""&&(i.nameInvalid=!0,t=!1),r.onFormError&&typeof r.onFormError=="function"?r.onFormError.apply(c,e):vt.apply(c,e),t}function ht(n,t,i){for(var u in n)typeof n[u]=="object"&&(t.beginPath(),t.moveTo(n[u].mx,n[u].my),t.lineTo(n[u].lx,n[u].ly),t.lineCap=r.penCap,t.stroke(),t.closePath(),i&&h.push({lx:n[u].lx,ly:n[u].ly,mx:n[u].mx,my:n[u].my}))}function yt(){parseFloat((/CPU.+OS ([0-9_]{3}).*AppleWebkit.*Mobile/i.exec(navigator.userAgent)||[0,"4_2"])[1].replace("_","."))<4.1&&(n.fn.Oldoffset=n.fn.offset,n.fn.offset=function(){var t=n(this).Oldoffset();return t.top-=window.scrollY,t.left-=window.scrollX,t});n(r.typed,u).bind("selectstart.signaturepad",function(t){return n(t.target).is(":input")});o.bind("selectstart.signaturepad",function(t){return n(t.target).is(":input")});!e.getContext&&FlashCanvas&&FlashCanvas.initElement(e);e.getContext&&(f=e.getContext("2d"),n(r.sig,u).show(),r.displayOnly||(r.drawOnly||(n(r.name,u).bind("keyup.signaturepad",function(){st(n(this).val())}),n(r.name,u).bind("blur.signaturepad",function(){st(n(this).val())}),n(r.drawIt,u).bind("click.signaturepad",function(n){n.preventDefault();tt()})),r.drawOnly||r.defaultAction==="drawIt"?tt():ot(),r.validateFields&&(n(t).is("form")?n(t).bind("submit.signaturepad",function(){return it()}):n(t).parents("form").bind("submit.signaturepad",function(){return it()})),n(r.sigNav,u).show()))}var c=this,r=n.extend({},n.fn.signaturePad.defaults,i),u=n(t),o=n(r.canvas,u),e=o.get(0),f=null,s={x:null,y:null},h=[],a=!1,v=!1,b=!1,nt=!1,p=30,l=p,k=0;n.extend(c,{signaturePad:"{{version}}",init:function(){yt()},updateOptions:function(t){n.extend(r,t)},regenerate:function(t){c.clearCanvas();n(r.typed,u).hide();typeof t=="string"&&(t=JSON.parse(t));ht(t,f,!0);r.output&&n(r.output,u).length>0&&n(r.output,u).val(JSON.stringify(h))},clearCanvas:function(){g()},getSignature:function(){return h},getSignatureString:function(){return JSON.stringify(h)},getSignatureImage:function(){var n=document.createElement("canvas"),t=null,i=null;return n.style.position="absolute",n.style.top="-999em",n.width=e.width,n.height=e.height,document.body.appendChild(n),!n.getContext&&FlashCanvas&&FlashCanvas.initElement(n),t=n.getContext("2d"),t.fillStyle=r.bgColour,t.fillRect(0,0,e.width,e.height),t.lineWidth=r.penWidth,t.strokeStyle=r.penColour,ht(h,t),i=n.toDataURL.apply(n,arguments),document.body.removeChild(n),n=null,i},validateForm:function(){return it()}})}n.fn.signaturePad=function(i){var r=null;return this.each(function(){n.data(this,"plugin-signaturePad")?(r=n.data(this,"plugin-signaturePad"),r.updateOptions(i)):(r=new t(this,i),r.init(),n.data(this,"plugin-signaturePad",r))}),r};n.fn.signaturePad.defaults={defaultAction:"typeIt",displayOnly:!1,drawOnly:!1,canvas:"canvas",sig:".sig",sigNav:".sigNav",bgColour:"#ffffff",penColour:"#145394",penWidth:2,penCap:"round",lineColour:"#ccc",lineWidth:2,lineMargin:5,lineTop:35,name:".name",typed:".typed",clear:".clearButton",typeIt:".typeIt a",drawIt:".drawIt a",typeItDesc:".typeItDesc",drawItDesc:".drawItDesc",output:".output",currentClass:"current",validateFields:!0,errorClass:"error",errorMessage:"Please enter your name",errorMessageDraw:"Please sign the document",onBeforeValidate:null,onFormError:null,onDraw:null,onDrawEnd:null}})(jQuery);
/*
//# sourceMappingURL=jquery.signaturepad.min.js.map
*/